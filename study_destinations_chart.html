<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Students Turn Away from US Universities | Data Visualization</title>
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #374151;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: white;
            color: #1f2937;
            padding: 20px 30px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .title {
            font-size: clamp(20px, 3vw, 28px);
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: clamp(12px, 1.5vw, 16px);
            opacity: 0.8;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-content {
            padding: 20px 30px;
        }

        .chart-container {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .sources-note {
            margin-top: 15px;
            text-align: center;
        }

        .sources {
            color: #4b5563;
            font-size: 14px;
            margin-bottom: 5px;
            line-height: 1.6;
        }

        .made-by {
            color: #4b5563;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 0;
        }

        /* Chart styles */
        .line {
            fill: none;
            stroke-width: 3;
        }

        .dot {
            stroke: white;
            stroke-width: 2;
            r: 5;
        }

        .dot:hover {
            r: 7;
            stroke-width: 3;
        }

        .axis {
            font-size: 12px;
        }

        .axis-label {
            font-size: 14px;
            font-weight: 600;
        }

        .legend {
            font-size: 13px;
            font-weight: 500;
        }

        .grid line {
            stroke: #e5e7eb;
            stroke-dasharray: 2,2;
            stroke-width: 1;
        }

        .grid path {
            stroke-width: 0;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px 12px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 6px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .main-content {
                padding: 30px 20px;
            }
            
            .chart-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Chinese Students Turn Away from US Universities</h1>
            <p class="subtitle">Chinese international students' interest in American higher education drops to five-year low amid rising geopolitical tensions</p>
        </header>
        
        <main class="main-content">
            <div class="chart-container">
                <div id="chart"></div>
            </div>
            
            <div class="sources-note">
                <p class="sources"><strong>Source:</strong> the Graduate Management Admission Council Prospective Students Survey, 2025 report</p>
                <p class="made-by">Made by Grace Jiang</p>
            </div>
        </main>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Data from CSV
        const rawData = [
            {year: "2019", destination: "Western Europe", percentage: 35},
            {year: "2019", destination: "United States", percentage: 33},
            {year: "2019", destination: "East & Southeast Asia", percentage: 23},
            {year: "2019", destination: "Canada", percentage: 5},
            {year: "2019", destination: "Australia & Pacific Islands", percentage: 3},
            {year: "2020", destination: "Western Europe", percentage: 35},
            {year: "2020", destination: "United States", percentage: 31},
            {year: "2020", destination: "East & Southeast Asia", percentage: 19},
            {year: "2020", destination: "Canada", percentage: 12},
            {year: "2020", destination: "Australia & Pacific Islands", percentage: 2},
            {year: "2021", destination: "Western Europe", percentage: 35},
            {year: "2021", destination: "United States", percentage: 27},
            {year: "2021", destination: "East & Southeast Asia", percentage: 27},
            {year: "2021", destination: "Canada", percentage: 9},
            {year: "2021", destination: "Australia & Pacific Islands", percentage: 1},
            {year: "2022", destination: "Western Europe", percentage: 32},
            {year: "2022", destination: "United States", percentage: 32},
            {year: "2022", destination: "East & Southeast Asia", percentage: 31},
            {year: "2022", destination: "Canada", percentage: 12},
            {year: "2022", destination: "Australia & Pacific Islands", percentage: 3},
            {year: "2023", destination: "Western Europe", percentage: 34},
            {year: "2023", destination: "United States", percentage: 26},
            {year: "2023", destination: "East & Southeast Asia", percentage: 25},
            {year: "2023", destination: "Canada", percentage: 9},
            {year: "2023", destination: "Australia & Pacific Islands", percentage: 4}
        ];

        // Color scheme for different destinations
        const colorScale = {
            "United States": "#ef4444",
            "Western Europe": "#3b82f6", 
            "East & Southeast Asia": "#22c55e",
            "Canada": "#f59e0b",
            "Australia & Pacific Islands": "#8b5cf6"
        };

        // Set dimensions and margins
        const margin = {top: 15, right: 180, bottom: 40, left: 50};
        const width = 900 - margin.left - margin.right;
        const height = 350 - margin.top - margin.bottom;

        // Create SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Parse years and get unique destinations
        const years = [...new Set(rawData.map(d => d.year))].sort();
        const destinations = [...new Set(rawData.map(d => d.destination))];

        // Create scales
        const xScale = d3.scalePoint()
            .domain(years)
            .range([0, width])
            .padding(0.1);

        const yScale = d3.scaleLinear()
            .domain([0, 100])
            .range([height, 0]);

        // Create line generator
        const line = d3.line()
            .x(d => xScale(d.year))
            .y(d => yScale(d.percentage))
            .curve(d3.curveMonotoneX);

        // Add grid lines
        const yGrid = d3.axisLeft(yScale)
            .tickSize(-width)
            .tickFormat("");

        svg.append("g")
            .attr("class", "grid")
            .call(yGrid);

        // Add axes
        const xAxis = svg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale));

        const yAxis = svg.append("g")
            .attr("class", "axis")
            .call(d3.axisLeft(yScale).tickFormat(d => d + "%"));

        // Add axis labels
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("fill", "#374151")
            .text("Percentage of Prospective Students");

        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
            .style("text-anchor", "middle")
            .style("fill", "#374151")
            .text("Year");

        // Group data by destination
        const dataByDestination = destinations.map(dest => ({
            destination: dest,
            values: rawData.filter(d => d.destination === dest)
        }));

        // Create tooltip
        const tooltip = d3.select("#tooltip");

        // Draw lines
        dataByDestination.forEach(data => {
            const path = svg.append("path")
                .datum(data.values)
                .attr("class", "line")
                .attr("d", line)
                .style("stroke", colorScale[data.destination]);

            // Add dots
            svg.selectAll(`.dot-${data.destination.replace(/\s+/g, '-').replace(/&/g, 'and')}`)
                .data(data.values)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => xScale(d.year))
                .attr("cy", d => yScale(d.percentage))
                .style("fill", colorScale[data.destination])
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>${d.destination}</strong><br/>${d.year}: ${d.percentage}%`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        });

        // Add legend
        const legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width + 30}, 20)`);

        destinations.forEach((dest, i) => {
            const legendItem = legend.append("g")
                .attr("transform", `translate(0, ${i * 22})`);

            legendItem.append("line")
                .attr("x1", 0)
                .attr("x2", 16)
                .attr("y1", 7)
                .attr("y2", 7)
                .style("stroke", colorScale[dest])
                .style("stroke-width", 2.5);

            legendItem.append("circle")
                .attr("cx", 8)
                .attr("cy", 7)
                .attr("r", 3)
                .style("fill", colorScale[dest]);

            legendItem.append("text")
                .attr("x", 20)
                .attr("y", 7)
                .attr("dy", "0.35em")
                .text(dest)
                .style("font-size", "11px")
                .style("fill", "#374151");
        });

        // Make chart responsive
        function resize() {
            const container = d3.select("#chart").node();
            const containerWidth = container.getBoundingClientRect().width;
            
            if (containerWidth < 800) {
                // Move legend below chart on smaller screens
                legend.attr("transform", `translate(20, ${height + 60})`);
                
                // Arrange legend items in two columns
                destinations.forEach((dest, i) => {
                    const legendItem = legend.select(`g:nth-child(${i + 1})`);
                    legendItem.attr("transform", `translate(${(i % 2) * 200}, ${Math.floor(i / 2) * 20})`);
                });
                
                // Increase bottom margin to accommodate legend
                svg.attr("height", height + margin.top + margin.bottom + 80);
            } else {
                // Reset to side position for larger screens
                legend.attr("transform", `translate(${width + 25}, 15)`);
                destinations.forEach((dest, i) => {
                    const legendItem = legend.select(`g:nth-child(${i + 1})`);
                    legendItem.attr("transform", `translate(0, ${i * 22})`);
                });
                svg.attr("height", height + margin.top + margin.bottom);
            }
        }

        // Initial resize
        resize();
        
        // Listen for window resize
        window.addEventListener('resize', resize);
    </script>
</body>
</html>
